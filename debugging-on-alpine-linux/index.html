<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Debugging and contributing on Alpine Linux | Archive of libesz-s piece on the web</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Debugging and contributing on Alpine Linux" /><meta name="author" content="Gergo Huszty" /><meta property="og:locale" content="en_US" /><meta name="description" content="In one of my previous posts I explained my renewed router / home server. One task of the box is to serve video/audio content on DLNA. One of the easy selection in this area is minidlna to do the streaming. So I grabbed the first working minidlna docker container, which in practice Alpine Linux based and started to use that." /><meta property="og:description" content="In one of my previous posts I explained my renewed router / home server. One task of the box is to serve video/audio content on DLNA. One of the easy selection in this area is minidlna to do the streaming. So I grabbed the first working minidlna docker container, which in practice Alpine Linux based and started to use that." /><link rel="canonical" href="https://libesz.github.io/debugging-on-alpine-linux/" /><meta property="og:url" content="https://libesz.github.io/debugging-on-alpine-linux/" /><meta property="og:site_name" content="Archive of libesz-s piece on the web" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-10-13T23:54:44+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Debugging and contributing on Alpine Linux" /><meta name="twitter:site" content="@gergo_huszty" /><meta name="twitter:creator" content="@Gergo Huszty" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"In one of my previous posts I explained my renewed router / home server. One task of the box is to serve video/audio content on DLNA. One of the easy selection in this area is minidlna to do the streaming. So I grabbed the first working minidlna docker container, which in practice Alpine Linux based and started to use that.","author":{"@type":"Person","name":"Gergo Huszty"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://libesz.github.io/debugging-on-alpine-linux/"},"@type":"BlogPosting","url":"https://libesz.github.io/debugging-on-alpine-linux/","headline":"Debugging and contributing on Alpine Linux","dateModified":"2017-10-13T23:54:44+02:00","datePublished":"2017-10-13T23:54:44+02:00","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Archive of libesz-s piece on the web</a></div><div class="site-subtitle font-italic">a site about my and my friends electronics and programming hobby projects</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/libesz" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/gergo_huszty" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['gergo.huszty','digitaltrip.hu'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Debugging and contributing on Alpine Linux</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Debugging and contributing on Alpine Linux</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Oct 13, 2017, 11:54 PM +0200" > Oct 13, 2017 <i class="unloaded">2017-10-13T23:54:44+02:00</i> </span> by <span class="author"> Gergo Huszty </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 13, 2020, 5:20 PM +0200" > Oct 13 <i class="unloaded">2020-10-13T17:20:34+02:00</i> </span></div></div><div class="post-content"><p>In one of my previous posts I <a href="/linux-based-router-reloaded/">explained</a> my renewed router / home server. One task of the box is to serve video/audio content on DLNA. One of the easy selection in this area is minidlna to do the streaming. So I grabbed the first working <a href="https://hub.docker.com/r/vimagick/minidlna/">minidlna docker container</a>, which in practice Alpine Linux based and started to <a href="https://github.com/libesz/lhs-ansible/blob/master/roles/minidlna/tasks/main.yml">use</a> that.</p><p>Our happiness was not instant using the new configuration. Minidlna was never rock-solid, but in this setup it definitely crashed from time to time. As I inspected it crashed every single time when something added to the media library, in practice when the download completed. After checking minidlna issues, I have not found anything useful, so decided to locate the exact problem.</p><!--more--><h1 id="get-our-hands-dirty">Get our hands dirty</h1><p>The investigation started with installing the <a href="https://www.gnu.org/software/gdb/"><em>gdb</em> debugger</a> inside the minidlna container. Since the project is written in pure C, that is the default way of doing this. Let’s create a container instance for the hacking and install minidlna + gdb.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>$ docker run -ti --name minidlna_debug alpine:3.5 sh
/ # apk update
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz
v3.5.2-90-g737768f35c [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]
v3.5.2-81-gf4d50b1370 [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]
OK: 7962 distinct packages available
/ # apk add minidlna gdb
[...]
Executing minidlna-1.1.5-r3.pre-install
Executing busybox-1.25.1-r0.trigger
OK: 98 MiB in 62 packages
/ # 
</pre></table></code></div></div><p>With the new image, running minidlna with gdb I reproduced the issue. A lot of basic gdb usage and cheat sheet can be found out there, will not go into details here. As it is expected, it exactly shows nothing else than the type of the exception, which was naturally a Segmentation Fault. Something happened here what is not user error for sure :). Linux distributions are usually not shipping debugging symbols in the default production binary packages, so gdb showed only cryptic memory address in the stack trace. You can actually check this right from the binary with the <em>file</em> tool:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># file /usr/sbin/minidlnad 
/usr/sbin/minidlnad: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, stripped, with debug_info
</pre></table></code></div></div><p>The main point is the notation that it is <em>stripped</em>. This means you have no symbol and source code information from compilation time.</p><p>That was the momentum when I had to get familiar with <a href="https://alpinelinux.org/">Alpine Linux</a> build system, because the present minidlna container image used that as a base. Actually it was already familiar to me on some level. I use it @work, it is popular for it’s extreme small size, etc. BTW size is the key why it is popular to build docker images on top of it. While mainstream full-blown distributions are consuming hundred(s) of MBs because of the lot usual tools in there by default, but Alpine base image is exactly 3.96MB today :).</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>$ docker images
REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE
ubuntu                          latest              7b9b13f7b9c0        7 days ago          118MB
alpine                          latest              a41a7446062d        2 weeks ago         3.96MB
</pre></table></code></div></div><h2 id="recompile-an-alpine-package">Recompile an Alpine package</h2><p>After spinning the Google, I found some intro page <a href="https://wiki.alpinelinux.org/wiki/Abuild_and_Helpers">like this</a> on how to recompile things. So <em>abuild</em> is the thing here. The whole compiling toolchain can be installed with a single command:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>apk add alpine-sdk
</pre></table></code></div></div><p>Apk it the package manager for alpine. You might call also “<em>apk update</em>” before the very first apk . <em>Abuild</em> is the tool for doing everything around package maintenance except that it won’t tell you how to get the package :(. One example of my failures:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>$ abuild fetch minidlna
&gt;&gt;&gt; ERROR: : Could not find ./APKBUILD (PWD=/)
</pre></table></code></div></div><p>Basically that is the response for anything until you get the right <em>APKBUILD</em>, whatever it is. Actually it is the main descriptor of the packages, one for each. After further utilizing the most famous search engines, I found out that <em>Alpine</em> guys are collecting their <em>APKBUILD_s and related files in a git repository. This is the _<a href="https://github.com/alpinelinux/aports/">aports</a></em>. The easiest way to get is to clone the whole repo with git. Let’s do it after creating a regular user (+add it to the abuild group) for building stuff:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>/ # adduser build
Changing password for build
New password: 
Retype password: 
passwd: password for build changed by root
/ # addgroup build abuild
/ # su build
/ $ cd
~ $ git clone https://github.com/alpinelinux/aports.git
Cloning into 'aports'...
remote: Counting objects: 344808, done.
remote: Compressing objects: 100% (54/54), done.
remote: Total 344808 (delta 29), reused 51 (delta 19), pack-reused 344732
Receiving objects: 100% (344808/344808), 165.25 MiB | 3.61 MiB/s, done.
Resolving deltas: 100% (209266/209266), done.
~ $ 
</pre></table></code></div></div><p>Depending on the release of the alpine release you might change to some other branch in the repo (like 3.5). Also, add your user to the sudoers as the tools are trying to use sudo it when root privileges are needed.</p><p>Create a key to be able to generate signed packages and get into to the minidlna directory:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>~ $ abuild-keygen -a -i
~ $ cd aports/community/minidlna/
~/aports/community/minidlna $
</pre></table></code></div></div><p>Now we are finally ready to build the repackage the package. Before that you need to update the checksums in the APKBUILD file:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>~/aports/community/minidlna $ abuild checksum &amp;&amp; abuild -r
&gt;&gt;&gt; minidlna: Updating the md5sums in APKBUILD...
&gt;&gt;&gt; minidlna: Updating the sha256sums in APKBUILD...
&gt;&gt;&gt; minidlna: Updating the sha512sums in APKBUILD...
&gt;&gt;&gt; minidlna: Checking sanity of /home/build/aports/community/minidlna/APKBUILD...
&gt;&gt;&gt; minidlna: Analyzing dependencies...
&gt;&gt;&gt; minidlna: Installing for build: build-base bsd-compat-headers libvorbis-dev libogg-dev libid3tag-dev libexif-dev libjpeg-turbo-dev sqlite-dev ffmpeg-dev flac-dev
WARNING: Ignoring /home/build/packages//community/x86_64/APKINDEX.tar.gz: No such file or directory
(1/49) Installing bsd-compat-headers (0.7-r1)
(2/49) Installing libogg (1.3.2-r1)

[...]

(49/49) Purging xvidcore (1.3.4-r0)
Executing busybox-1.25.1-r0.trigger
OK: 192 MiB in 68 packages
&gt;&gt;&gt; minidlna: Updating the community/x86_64 repository index...
&gt;&gt;&gt; minidlna: Signing the index...
~/aports/community/minidlna $ 
</pre></table></code></div></div><p>Somewhere in the middle you can inspect that the code is actually compiled. The final package can be found in ~/packages… .</p><p>Let’s install it:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>/ # apk add /home/build/packages/community/x86_64/minidlna-1.1.5-r3.apk
(1/40) Installing libogg (1.3.2-r1)

[...]

(40/40) Installing minidlna (1.1.5-r3)
Executing minidlna-1.1.5-r3.pre-install
Executing busybox-1.25.1-r0.trigger
OK: 232 MiB in 108 packages
/ # 
</pre></table></code></div></div><h2 id="get-debugging-symbols-in">Get debugging symbols in</h2><p>Now we still have stripped end-result (you can check it with the file command after installing it with “<em>apk add file</em>”). We can change the compilation to let the debug symbols stay in the binary. It is about to add an option to the APKBUILD file of the package:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>options="!strip"
</pre></table></code></div></div><p>If now you recompile and re-install the package, the file command confirms that we are getting closer:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/ # file /usr/sbin/minidlnad 
/usr/sbin/minidlnad: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, not stripped
</pre></table></code></div></div><p>So we have the not stripped binary. As I reproduced the problem with this, I got the correct stack trace for real debugging.</p><h2 id="contribution">Contribution</h2><p>Let’s jump over the actual correction for now. The point is that the aports library actually does not contain the main source tree of the project, it only refers to the original source repo. What it really contains is:</p><ul><li>The build configuration for the alpine system (the APKBUILD file).</li><li>Sample configuration or other files for the target system to be used after installation.</li><li>Installation, upgrade hooks for the package management events.</li><li>Finally the most important: the patches. If the project needs some source patches in order to run correctly on Alpine linux, those are added to this repo and applied during compilation.</li></ul><p>Generally, if the problem happened to be a real bug in the software, you might end up with a patch for the software what fixes the issue. If you decide to contribute it back to the upstream, there can be two targets. If if is a generic bug in the software, you should send it to the author. In my case the correction was a special one, because the bug is alpine specific. It crashed because of the extreme small size of the child threads of a process. So my patch belongs to the aports repo. I sent the patch to their mail based patch handling system and after some mail exchange with the package maintainer it got <a href="http://patchwork.alpinelinux.org/patch/2940/">approved</a>. You can be much smarter by sending a patch directly to github, as I realized since than that they accept contribution <a href="https://github.com/alpinelinux/aports/">there</a> also :).</p><p>My contribution is finally in the <a href="https://pkgs.alpinelinux.org/package/v3.6/community/x86_64/minidlna">stable 3.6 realease</a> of the alpine distribution and I can use it without issues, hurray :).</p><h3 id="some-further-references-for-the-alpine-package-build-system">Some further references for the alpine package build system:</h3><p><a href="https://wiki.alpinelinux.org/wiki/APKBUILD_Reference">https://wiki.alpinelinux.org/wiki/APKBUILD_Reference</a></p><p><a href="https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package">https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package</a></p><p><a href="https://wiki.alpinelinux.org/wiki/Abuild_and_Helpers">https://wiki.alpinelinux.org/wiki/Abuild_and_Helpers</a></p><p><a href="https://wiki.alpinelinux.org/wiki/Include:Setup_your_system_and_account_for_building_packages">https://wiki.alpinelinux.org/wiki/Include:Setup_your_system_and_account_for_building_packages</a></p><p> </p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/alpine/" class="post-tag no-text-decoration" >alpine</a> <a href="/tags/container/" class="post-tag no-text-decoration" >container</a> <a href="/tags/dlna/" class="post-tag no-text-decoration" >dlna</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/minidlna/" class="post-tag no-text-decoration" >minidlna</a> <a href="/tags/router/" class="post-tag no-text-decoration" >router</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Debugging and contributing on Alpine Linux - Archive of libesz-s piece on the web&url=https://libesz.github.io/debugging-on-alpine-linux/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Debugging and contributing on Alpine Linux - Archive of libesz-s piece on the web&u=https://libesz.github.io/debugging-on-alpine-linux/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Debugging and contributing on Alpine Linux - Archive of libesz-s piece on the web&url=https://libesz.github.io/debugging-on-alpine-linux/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/atmega8/">atmega8</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/c%23/">C#</a> <a class="post-tag" href="/tags/toner-transfer-method/">toner transfer method</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/ledcube/">ledcube</a> <a class="post-tag" href="/tags/led-cube/">led cube</a> <a class="post-tag" href="/tags/led/">led</a> <a class="post-tag" href="/tags/dotnet/">dotNet</a> <a class="post-tag" href="/tags/water/">water</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/automatic-hot-water-circulator/" class="btn btn-outline-primary"><p>Automatic hot water circulator</p></a> <a href="/reverse-engineering-my-fiber-to-the_home-device/" class="btn btn-outline-primary"><p>Reverse engineering my Fiber-To-The_Home device.</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/gergo_huszty">Gergo Huszty</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/atmega8/">atmega8</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/c%23/">C#</a> <a class="post-tag" href="/tags/toner-transfer-method/">toner transfer method</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/ledcube/">ledcube</a> <a class="post-tag" href="/tags/led-cube/">led cube</a> <a class="post-tag" href="/tags/led/">led</a> <a class="post-tag" href="/tags/dotnet/">dotNet</a> <a class="post-tag" href="/tags/water/">water</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://libesz.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
