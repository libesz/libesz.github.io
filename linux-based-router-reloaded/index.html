<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>linux based router reloaded | Archive of libesz-s piece on the web</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="linux based router reloaded" /><meta name="author" content="Gergo Huszty" /><meta property="og:locale" content="en_US" /><meta name="description" content="Hi," /><meta property="og:description" content="Hi," /><link rel="canonical" href="https://libesz.github.io/linux-based-router-reloaded/" /><meta property="og:url" content="https://libesz.github.io/linux-based-router-reloaded/" /><meta property="og:site_name" content="Archive of libesz-s piece on the web" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-10-23T17:16:07+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="linux based router reloaded" /><meta name="twitter:site" content="@gergo_huszty" /><meta name="twitter:creator" content="@Gergo Huszty" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Hi,","author":{"@type":"Person","name":"Gergo Huszty"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://libesz.github.io/linux-based-router-reloaded/"},"@type":"BlogPosting","url":"https://libesz.github.io/linux-based-router-reloaded/","headline":"linux based router reloaded","dateModified":"2016-10-23T17:16:07+02:00","datePublished":"2016-10-23T17:16:07+02:00","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Archive of libesz-s piece on the web</a></div><div class="site-subtitle font-italic">a site about my and my friends electronics and programming hobby projects</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/libesz" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/gergo_huszty" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['gergo.huszty','digitaltrip.hu'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>linux based router reloaded</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>linux based router reloaded</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 23, 2016, 5:16 PM +0200" > Oct 23, 2016 <i class="unloaded">2016-10-23T17:16:07+02:00</i> </span> by <span class="author"> Gergo Huszty </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 13, 2020, 5:20 PM +0200" > Oct 13 <i class="unloaded">2020-10-13T17:20:34+02:00</i> </span></div></div><div class="post-content"><p>Hi,</p><p>It’s been a long time since I set up my <a href="/my_linux_based_router/">mini-itx based router/download machine</a>. It got a few unavoidable HW upgrade (power supply, new HDD) but the performance of that is remained. From SW point of view however, it has a lot more load and responsibility. The HD age with the smart TVs are here, so that the machine is not anymore a basic router/NAS, but something like a HTPC. I use <a href="https://sourceforge.net/projects/minidlna/">minidlna</a> to stream the content towards our smart TVs. Now the performance of the famous <a href="http://ark.intel.com/products/35635/Intel-Atom-Processor-230-512K-Cache-1_60-GHz-533-MHz-FSB">Intel Atom 230</a> is over unfortunately. The 100Mb/s internet is also a reality now and if the content is downloaded at max speed to the encrypted HDDs, it consumes the CPU entirely and the stream basically starts to lag. Of course it is possible to limit the CPU usage or the downloading bandwidth for rtorrent, but that would be a workaround only.<!--more--></p><h2 id="the-plan">The plan</h2><p>Challenge accepted: reload the central part of our IT infrastructure at home. Every such project shall have some input requirements. My list:</p><ul><li>HW:<ul><li>Upgrade to 1Gb/s ethernet on both LAN and WAN side</li><li>Get enough CPU power again for the next at least 5 years</li><li>Reuse as much component as possible</li><li>Should still consume only a few Watts of energy</li></ul></li><li>SW:<ul><li>Reinstall with 64bit OS</li><li>Use uptodate, even over hyped technologies for the operation</li></ul></li></ul><h2 id="hardware">Hardware</h2><p>From gigabit point of view we were almost already fine. On the LAN side the 100Mb/s switch died some years ago so that I bought a new gigabit version of that. We only need some gigabit NIC to go. To fulfill the remaining requirements, I started to check the ebay-equivalent hungarian market for some mint conditioned, used and cheap mini-itx motherboard. After a few weeks I got this: <a href="http://www.asrock.com/mb/Intel/N3700-ITX/">Asrock N3700-ITX</a>. It costed half as much as was the last price in the stock, like 60 EUR. The <a href="http://ark.intel.com/products/87261/Intel-Pentium-Processor-N3700-2M-Cache-up-to-2_40-GHz">Pentium N3700</a> has built-in AES capabilities and 4 real cores, based on Braswell. I had a spare Intel 1000 PT for secondary ethernet card and I pulled out a 2GB DDR3 SO-DIMM from my laptop, so we are good to go from HW PoV.</p><p><a href="/assets/images/2016/10/IMG_20161020_183659.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/2016/10/IMG_20161020_183659-300x225.jpg" alt="The old retired HW." /></a> <em>The old retired HW.</em></p><p><a href="/assets/images/2016/10/IMG_20161020_183726.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/2016/10/IMG_20161020_183726-300x225.jpg" alt="The new mobo and the Intel NIC" /></a> <em>The new mobo and the Intel NIC</em></p><p><a href="/assets/images/2016/10/IMG_20161020_183740.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/2016/10/IMG_20161020_183740-300x225.jpg" alt="The sad fate project box in the middle of the operation. I had to drill yet another hole to have the new NIC fixed." /></a> <em>The sad fate project box in the middle of the operation. I had to drill yet another hole to have the new NIC fixed.</em></p><h2 id="software">Software</h2><p>The SW part was more entertaining than fixing the enclosure to fit for the new PCI-e network card. :)</p><p>As I am not a professional person in real linux operation, my installations usually are patched whenever needed because of new need of something failed. So this box represented my laziness. Basically I had no idea of how was some pieces configured, and why, and when :). People usually have backups from the critical data which holds the value, so did I. But no backup/list/doc of the sw components. I had to rediscover the things and create a plan how to apply everything on a new OS. Here comes the over-hyped technologies.</p><h3 id="ansible">Ansible</h3><p>There is a buzzword nowadays, which is: <a href="https://en.wikipedia.org/wiki/Infrastructure_as_Code">infrastructure as code</a>. The point is to not have the components settings and relations in mind (or better: in doc), but in machine processable definition files. Something like what Makefile does for software, these definitions are for OS components configurations. One of the popular solutions for this is <a href="https://www.ansible.com/">Ansible</a>. If you are a hardcode shell script guy, you might think what is the advance in these specialized solutions. I found these:</p><ul><li>Definition files are reusable as components</li><li>Idempotent nature of the ansible modules avoid unnecessary execution</li><li>Ansible is totally agentless: you don’t have to have anything on the target machine, uses pure SSH</li></ul><p>Of course, the real advantage of ansible is if you have dozens of servers or VM instances in the cloud, so using it for my router is overkill. Indeed. But once I produced my playbooks for the router, the configuration is self documented. No need to reinvent the wheel next time. Well, hopefully :).</p><p>Let’s have an example: we want to set up a dhcp service with dnsmasq on a debian system. You can do it manually: use apt-get/aptitude to install the package and the dependencies, tweak the config file manually, restart the service. Or you can put the steps into a shell script if you want some self-documentation. In this case you have a chance to reproduce the tasks in the future. Now, with configuration automation tools you have to only declare the desired state of the system instead of scripting everything manually. Of course you express the steps in some sense, but due to the idempotent nature, whenever you run the playbook again, it will make changes only where the actual state of the target system differs from the desired state. Let’s see the dnsmasq’s task file:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dnsmasq</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>
  <span class="na">apt</span><span class="pi">:</span> <span class="s">pkg=dnsmasq state=installed</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure dnsmasq for dhcp</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>
  <span class="na">notify</span><span class="pi">:</span> <span class="s">Restart dnsmasq</span>
  <span class="na">template</span><span class="pi">:</span> <span class="s">src=dnsmasq.conf.j2 dest=/etc/dnsmasq.conf</span>
</pre></table></code></div></div><p>What do we have here?! The first step is more or less straightforward: install the dnsmasq package and the dependencies with apt package manager. The become statement means it must run with superuser, with a preselected method (e.g. sudo). The task statement is more interesting. It refers to a template configuration dnsmasq.conf.j2. The content of the template can be the following:</p><div class="language-ini highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="py">dhcp-range</span><span class="p">=</span><span class="s">,192.168.1.20,192.168.1.98,72h</span>
<span class="py">interface</span><span class="p">=</span>
</pre></table></code></div></div><p>Ansible’s native template filling mechanism is called <a href="http://jinja.pocoo.org/docs/dev/">jinja2</a>. You can define a variable set separated from your tasks and feed when you start the playbook. The other stranger line is the notify statement. You can notify special tasks called handlers. They are invoked only if the caller task made real changes. This handler looks like:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Restart dnsmasq</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>
  <span class="na">service</span><span class="pi">:</span> <span class="s">name=dnsmasq state=restarted</span>
</pre></table></code></div></div><p>You can collect these task+handler+template packages into so-called <a href="http://docs.ansible.com/ansible/playbooks_roles.html">roles</a>. I used a sandbox VM to develop the playbooks prior to the motherboard change to minimize the maintenance window of the production system :).</p><h3 id="docker">Docker</h3><p>If you keep your eyes open in the IT world, you most probably heard about <a href="https://www.docker.com/">docker</a>, or at least the hype of the containerization. It made a fundamental change in the world in the last 1-2 years. Companies like Spotify, Uber, SoundCloud, etc. actually use it from the time when docker was not even in production state. But why is this a real turnaround, what is behind the buzzword “<a href="http://www.informationweek.com/cloud/platform-as-a-service/cloud-native-what-it-means-why-it-matters/d/d-id/1321539">cloud-native</a>”? On the lowest level, a well crafted running container instance is nothing more than a linux process, in correct isolation. Something how a process shall be isolated from the beginning of the multitasking operating systems. Comparing to cloud computing, here the process is detached from the underlying OS like VM is detached from the real hardware. Containers utilizes <a href="http://man7.org/linux/man-pages/man7/namespaces.7.html">linux namespaces</a>. The only shared part of the host OS and the container (and also between the containers) is the host’s kernel. Linux kernel has a pretty stable APIs, so that the compatibility is not an issue.</p><ul><li>Mount namespace ensures that the process it entirely enclosed in it’s image. It can not examine other processes/services playground in the filesystem. You can bind-mount files/directories from the host or network if the container needs external content or for the sake of persistency.</li><li>Network namespace ensures that you can restrict the app’s connectivity without global finetuned firewall rules in the OS.</li><li>With PID namespace every application think that it is the only process in the system (actually the PID 1).</li></ul><p>There are other namespaces but these are the most relevant.</p><p>Docker can be used on it’s own, with CLI. Containerization in fact evolved to a totally flexible utilization of resources. Docker is only one brick here: it has tools on the top of it for orchestration, scheduling, scaling, healing, etc. The good container is designed to be totally independent of it’s infrastructure and have a very short list of requirements. The possibilities here are the must-have configuration parameters (in the form of env.variables), the resource limits, other required services (linking to other containers like a DB on the network), the intentionally exposed listening tcp or udp ports for the service and some persistent storage. You can supply these directly in docker CLI, or you can express them in a YAML file and feed it to a small tool called <a href="https://docs.docker.com/compose/overview/">docker-compose</a>. There are special topics how ideally a container should look like (<a href="http://blog.xebia.com/how-to-create-the-smallest-possible-docker-container-of-any-image/">small size</a>, <a href="http://www.projectatomic.io/blog/2015/12/making-docker-images-write-only-in-production/">readonly nature</a>, etc.).</p><p>Getting back to the present project, for me docker helped to get ready-made self-containing apps. Most probably other people also do things like me, so most probably others already created containers for my need as well :).</p><h3 id="putting-all-together">Putting all together</h3><p>Ansible has a lot of built-in modules to interact with services, not only installing packages, copying and altering config files. So it can interact directly with docker-compose to start my containerized services. I ended up with a role collection and a top-level playbook with which I can anytime force my box to the desired state. You can check the stuff on <a href="https://github.com/libesz/lhs-ansible">github</a>. Some migration related things are hard to do with ansible like initialization of the raid arrays and renaming the network interfaces. So the box needed some natural preparation after the minimal OS was there, but not that much.</p><p>There are a few missing parts as I would like to monitor my containers and maybe build my own containers in some cases, but the workflow is now written in stone at least :).</p><p>Cheers!</p><p> </p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ansible/" class="post-tag no-text-decoration" >ansible</a> <a href="/tags/debian/" class="post-tag no-text-decoration" >debian</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/router/" class="post-tag no-text-decoration" >router</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=linux based router reloaded - Archive of libesz-s piece on the web&url=https://libesz.github.io/linux-based-router-reloaded/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=linux based router reloaded - Archive of libesz-s piece on the web&u=https://libesz.github.io/linux-based-router-reloaded/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=linux based router reloaded - Archive of libesz-s piece on the web&url=https://libesz.github.io/linux-based-router-reloaded/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/atmega8/">atmega8</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/c%23/">C#</a> <a class="post-tag" href="/tags/toner-transfer-method/">toner transfer method</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/ledcube/">ledcube</a> <a class="post-tag" href="/tags/led-cube/">led cube</a> <a class="post-tag" href="/tags/led/">led</a> <a class="post-tag" href="/tags/dotnet/">dotNet</a> <a class="post-tag" href="/tags/water/">water</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/project-grass-head/" class="btn btn-outline-primary"><p>Project: Grass Head [time lapse video]</p></a> <a href="/cpp-on-avr/" class="btn btn-outline-primary"><p>C++ on AVR</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/gergo_huszty">Gergo Huszty</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/atmega8/">atmega8</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/c%23/">C#</a> <a class="post-tag" href="/tags/toner-transfer-method/">toner transfer method</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/ledcube/">ledcube</a> <a class="post-tag" href="/tags/led-cube/">led cube</a> <a class="post-tag" href="/tags/led/">led</a> <a class="post-tag" href="/tags/dotnet/">dotNet</a> <a class="post-tag" href="/tags/water/">water</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://libesz.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
